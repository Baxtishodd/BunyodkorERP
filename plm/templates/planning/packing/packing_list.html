{% extends "base1.html" %}
{% block content %}
<h3>Tasdiqlangan buyurtmalar uchun qadoqlash ro‘yxati</h3><br>
{% if orders_with_totals %}
<div class="card mt-4 border-secondary shadow-sm">
    <div class="card-body text-center fw-bold">
        <span class="me-4">Umumiy qadoqlangan mahsulot: <span class="text-success">{{ total_products_sum }}</span></span>
        <span class="text-primary">Umumiy yopilgan karopka: {{ total_boxes_sum }}</span>
    </div>
</div>
{% endif %}
{% for item in orders_with_totals %}
    {% with order=item.order %}
    <div class="card mb-3 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong>Buyurtma:
                <a href="{% url 'plm:order_detail' order.pk %}" class="btn btn-light rounded-5">{{ order }}</a>
            </strong>
            <a href="{% url 'plm:packing_add_to_order' order.id %}" class="btn btn-sm btn-success">
                + Qadoqlash qo‘shish
            </a>
        </div>
        <div class="card-body p-0">
            <table class="table mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Qadoq turi</th>
                        <th>Qadoqlangan mahsulotlar</th>
                        <th>Yopilgan karopkalar</th>
                        <th>Qadoqlangan sana</th>
                        <th>Yaratilgan</th>
                        <th class="text-end">Amallar</th>
                    </tr>
                </thead>
                <tbody>
                    {% for packing in order.packings.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td><span class="badge bg-info">{{ packing.get_packing_type_display }}</span></td>
                        <td class="text-success fw-semibold">{{ packing.product_quantity }}</td>
                        <td class="text-primary fw-semibold">{{ packing.box_quantity }}</td>
                        <td><span class="badge bg-primary">{{ packing.packed_date|date:"d.m.Y" }}</span></td>
                        <td>{{ packing.created_at|date:"d.m.Y H:i" }}</td>
                        <td class="text-end">
                            <a href="{% url 'plm:packing_update' packing.pk %}" class="btn btn-sm btn-primary">
                                <i class="bi bi-pencil"></i>
                            </a>
                            <a href="{% url 'plm:packing_delete' packing.pk %}" class="btn btn-sm btn-danger">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">Hozircha qadoqlash ma’lumoti yo‘q</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="fw-bold">
                        <td colspan="7" class="text-start ps-3">
                            Jami qadoqlangan mahsulot: <span class="text-success">{{ item.product_quantity }}</span> |
                            Jami yopilgan karopka: <span class="text-primary">{{ item.box_quantity }}</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {% endwith %}
{% empty %}
    <p>Hozircha buyurtmalar mavjud emas</p>
{% endfor %}


{% endblock %}
