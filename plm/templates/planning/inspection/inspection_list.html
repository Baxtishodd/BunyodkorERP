{% extends "base1.html" %}
{% block content %}
<h3>Tasdiqlangan buyurtmalar uchun Sifat nazoratidan o`tgan modellar ro`yhati</h3><br>

{% if orders_with_totals %}
<div class="card mt-4 border-secondary shadow-sm">
    <div class="card-body text-center fw-bold">
        <span class="me-4">Umumiy tekshirilgan: {{ total_checked_sum }}</span>
        <span class="me-4 text-success">O‘tgan: {{ passed_sum }}</span>
        <span class="text-danger">O‘tmagan: {{ failed_sum }}</span>
    </div>
</div>
{% endif %}

{% for item in orders_with_totals %}
    {% with order=item.order %}
    <div class="card mb-3 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <strong>Buyurtma:
                <a href="{% url 'plm:order_detail' order.pk %}" class="btn btn-light rounded-5">{{ order }}</a>
            </strong>
            <a href="{% url 'plm:inspection_add_to_order' order.id %}" class="btn btn-sm btn-success">
                + Ish qo‘shish
            </a>
        </div>
        <div class="card-body p-0">
            <table class="table mb-0 align-middle">
                <thead class="table-light">
                    <tr>
                        <th>#</th>
                        <th>Umumiy tekshirilgan</th>
                        <th>Sifatdan o‘tgan</th>
                        <th>Sifatdan o‘tmagan</th>
                        <th>O‘tgan %</th>
                        <th>Tekshirilgan sana</th>
                        <th>Yaratilgan</th>
                        <th class="text-end"></th>
                    </tr>
                </thead>
                <tbody>
                    {% for inspection in order.inspections.all %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ inspection.total_checked }}</td>
                        <td class="text-success fw-semibold">{{ inspection.passed_quantity }}</td>
                        <td class="text-danger fw-semibold">{{ inspection.failed_quantity }}</td>
                        <td>
                            <div class="progress" style="height: 15px;">
                                <div class="progress-bar bg-success" role="progressbar"
                                     style="width: {{ inspection.passed_percentage }}%;"
                                     aria-valuenow="{{ inspection.passed_percentage }}"
                                     aria-valuemin="0" aria-valuemax="100">
                                     {{ inspection.passed_percentage }}%
                                </div>
                            </div>
                        </td>
                        <td><span class="badge bg-primary">{{ inspection.inspected_date|date:"d.m.Y" }}</span></td>
                        <td>{{ inspection.created_at|date:"d.m.Y H:i" }}</td>
                        <td class="text-end">
                          <a href="{% url 'plm:inspection_update' inspection.pk %}" class="btn btn-sm btn-primary">
                                <i class="bi bi-pen-fill"></i>
                          </a>
                          <a href="{% url 'plm:inspection_delete' inspection.pk %}"
                             class="btn btn-sm btn-danger">
                              <i class="bi bi-trash"></i>
                          </a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">Hozircha sifat nazorati ma’lumoti yo‘q</td>
                    </tr>
                    {% endfor %}
                </tbody>
                <tfoot>
                    <tr class="fw-bold">
                        <td colspan="8" class="text-start ps-3">
                            Jami tekshirilgan: {{ item.total_checked }} |
                            Sifatdan o‘tgan: <span class="text-success">{{ item.passed }}</span> |
                            Sifatdan o‘tmagan: <span class="text-danger">{{ item.failed }}</span>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {% endwith %}
{% empty %}
    <p>Hozircha buyurtmalar mavjud emas</p>
{% endfor %}


{% endblock %}
