{% extends "base1.html" %}
{% load static %}

{% block content %}
<div class="container-fluid mt-4">
  <h4 class="fw-bold mb-4">üìä Ishlab chiqarish paneli</h4>

  <!-- Statistik kartalar -->
  <div class="row g-3 mb-4">
    <div class="col-md-2 col-sm-6">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Jami buyurtmalar</h6>
          <h2 class="fw-bold text-primary">{{ total_orders }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-6">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Faol buyurtmalar</h6>
          <h2 class="fw-bold text-warning">{{ active_orders }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-6">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Bajarilgan</h6>
          <h2 class="fw-bold text-success">{{ completed_orders }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-6">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Xodimlar</h6>
          <h2 class="fw-bold text-info">{{ total_employees }}</h2>
        </div>
      </div>
    </div>
    <div class="col-md-2 col-sm-6">
      <div class="card text-center shadow-sm border-0">
        <div class="card-body">
          <h6 class="text-muted">Patoklar</h6>
          <h2 class="fw-bold text-secondary">{{ total_lines }}</h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Grafik va patoklar -->
  <div class="row">
    <div class="col-md-7 mb-4">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-light fw-semibold">üìà So‚Äònggi 6 oyda yaratilgan buyurtmalar</div>
        <div class="card-body">
          <canvas id="ordersChart" height="130"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-5 mb-4">
      <div class="card shadow-sm border-0">
        <div class="card-header bg-light fw-semibold">üè≠ Patoklar progressi</div>
        <div class="card-body">
          {% for line in line_progress %}
          <div class="mb-3">
            <div class="d-flex justify-content-between">
              <span><strong>{{ line.name }}</strong> ‚Äî {{ line.client }} ({{ line.artikul }})</span>
              <span class="text-muted">{{ line.progress }}%</span>
            </div>
            <div class="progress mt-1" style="height: 10px;">
              <div class="progress-bar bg-success" style="width: {{ line.progress }}%;"></div>
            </div>
          </div>
          {% empty %}
          <p class="text-muted mb-0">Faol patoklar yo‚Äòq</p>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>

  <!-- So‚Äònggi buyurtmalar -->
  <div class="card shadow-sm border-0">
    <div class="card-header bg-light fw-semibold">üßæ So‚Äònggi buyurtmalar</div>
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Mijoz</th>
            <th>Artikul</th>
            <th>Rangi</th>
            <th>Holati</th>
            <th>Yaratilgan</th>
          </tr>
        </thead>
        <tbody>
          {% for order in latest_orders %}
          <tr>
            <td>{{ order.client }}</td>
            <td>{{ order.artikul }}</td>
            <td>{{ order.rangi }}</td>
            <td>
              <span class="badge bg-{% if order.status == 'completed' %}success{% elif order.status == 'in_production' %}warning{% else %}secondary{% endif %}">
                {{ order.get_status_display }}
              </span>
            </td>
            <td>{{ order.created_at|date:"d.m.Y H:i" }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="5" class="text-center text-muted py-4">Buyurtmalar topilmadi</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('ordersChart');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Buyurtmalar soni',
        data: {{ chart_data|safe }},
        borderColor: '#0d6efd',
        backgroundColor: 'rgba(13, 110, 253, 0.1)',
        borderWidth: 2,
        tension: 0.3,
        fill: true,
        pointRadius: 4,
      }]
    },
    options: {
      scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } },
      plugins: { legend: { display: false } }
    }
  });
</script>
{% endblock %}
